<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Quest - Mario-Style World Map</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        .score-display, .progress-display {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
        }
        .main-content {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .map-section {
            flex: 1;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
        }
        .map-title {
            text-align: center;
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 15px;
        }

        /* Retro-Style Overworld Map Background */
        .world-map {
            position: relative;
            width: 100%;
            height: 500px;
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 25%, #8BC34A 50%, #CDDC39 75%, #FFEB3B 100%);
            border-radius: 15px;
            overflow: hidden;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* Terrain Regions */
        .world-map::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                /* Forest region (top-left) */
                radial-gradient(circle at 20% 20%, #2E7D32 0%, #2E7D32 30%, transparent 70%),
                /* Water region (bottom-left) */
                radial-gradient(circle at 15% 80%, #1976D2 0%, #1976D2 40%, transparent 80%),
                /* Desert region (top-right) */
                radial-gradient(circle at 80% 15%, #F57C00 0%, #F57C00 35%, transparent 75%),
                /* Mountain region (bottom-right) */
                radial-gradient(circle at 85% 85%, #616161 0%, #616161 45%, transparent 85%);
            opacity: 0.7;
        }

        /* Paths and Bridges */
        .world-map::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                /* Main path */
                linear-gradient(45deg, #8D6E63 2px, transparent 2px) 0 0 / 20px 20px,
                /* Bridge */
                linear-gradient(90deg, #795548 3px, transparent 3px) 50% 70% / 15px 3px,
                /* Ladder */
                linear-gradient(180deg, #424242 2px, transparent 2px) 75% 20% / 2px 15px;
            opacity: 0.6;
        }

        /* Stage nodes - absolutely positioned <img> elements */
        .stage-node {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 10;
        }

        /* Checkpoint tooltip */
        .checkpoint-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .checkpoint-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .checkpoint-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
        }

        .stage-node.completed {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            animation: nodeGlow 2s ease-in-out infinite alternate;
        }

        .stage-node.current {
            background: linear-gradient(45deg, #FF9800, #FFC107);
            transform: scale(1.2);
            animation: nodePulse 1.5s ease-in-out infinite;
        }

        .stage-node.locked {
            background: linear-gradient(45deg, #9E9E9E, #BDBDBD);
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stage-node.unlocked {
            background: linear-gradient(45deg, #2196F3, #42A5F5);
        }

        .stage-node:hover:not(.locked) {
            transform: scale(1.1);
        }

        @keyframes nodeGlow {
            0% { box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4); }
            100% { box-shadow: 0 4px 12px rgba(76, 175, 80, 0.8); }
        }

        @keyframes nodePulse {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.3); }
        }

        /* Player character - <img> element */
        .player {
            position: absolute;
            width: 60px;
            height: 60px;
            z-index: 20;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }

        .player img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid #FFD700;
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .player.moving {
            animation: playerBounce 0.6s ease-in-out infinite;
        }

        @keyframes playerBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .sidebar {
            width: 300px;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .leaderboard {
            margin-bottom: 20px;
        }
        .leaderboard h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .leaderboard-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .leaderboard-info {
            flex: 1;
        }
        .leaderboard-name {
            font-weight: bold;
            font-size: 0.9rem;
            color: #333;
        }
        .leaderboard-progress {
            font-size: 0.8rem;
            color: #666;
        }
        .question-section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }
        .question-container {
            text-align: center;
        }
        .question {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        .answer-btn {
            padding: 12px 20px;
            font-size: 1.1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .answer-btn:hover {
            transform: scale(1.05);
        }
        .answer-btn.correct {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
        }
        .answer-btn.incorrect {
            background: linear-gradient(45deg, #f44336, #e57373);
        }
        .feedback {
            margin: 15px 0;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 12px;
            border-radius: 10px;
            display: none;
        }
        .feedback.correct {
            background: #4CAF50;
            color: white;
        }
        .feedback.incorrect {
            background: #f44336;
            color: white;
        }
        .game-over {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }
        .game-over h2 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 15px;
        }
        .final-score {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 20px;
        }
        .play-again-btn, .back-btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
        }
        .play-again-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
        }
        .back-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        .play-again-btn:hover, .back-btn:hover {
            transform: scale(1.05);
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            width: 0%;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
            }
            .world-map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üó∫Ô∏è Knowledge Quest</h1>
            <p>Embark on an epic adventure through the world map!</p>
        </div>

        <div class="game-stats">
            <div class="score-display">Score: <span id="score">0</span></div>
            <div class="progress-display">Progress: <span id="progress">1/8</span></div>
        </div>

        <div class="main-content">
            <div class="map-section">
                <div class="map-title">World Adventure Map</div>
                <div class="world-map" id="worldMap">
                    <!-- Checkpoint tooltip -->
                    <div class="checkpoint-tooltip" id="tooltip"></div>

                    <!-- Stage nodes with unique icons -->
                    <img class="stage-node unlocked" id="node-0" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTAiIHk9IjMwIiB3aWR0aD0iMzAiIGhlaWdodD0iMTUiIGZpbGw9IiM4RjU5MjciIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xMCAzMEwxMCAxNUwxNSAxMEwxNSAxNUwxMCAxNVoiIGZpbGw9IiM4RjU5MjciIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiNGRkYiLz4KPHRleHQgeD0iMjUiIHk9IjQ1IiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4xPC90ZXh0Pgo8L3N2Zz4=" alt="House - Pangngalan" style="top: 375px; left: 85px;" onclick="showQuestion(0)">
                    <img class="stage-node locked" id="node-1" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTUiIHk9IjMwIiB3aWR0aD0iMjAiIGhlaWdodD0iMTUiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xNSAzMEwxNSAxNUwyMCAxMEwyMCAxNUwxNSAxNVoiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiNGRkYiLz4KPHRleHQgeD0iMjUiIHk9IjQ1IiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4yPC90ZXh0Pgo8L3N2Zz4=" alt="Tree House - Pandiwa" style="top: 305px; left: 285px;" onclick="showQuestion(1)">
                    <img class="stage-node locked" id="node-2" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTUiIHk9IjI1IiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbGw9IiM4RjU5MjciIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xNSAyNUwxNSAxMEwyMCA1TDIwIDEwTDE1IDEwWiIgZmlsbD0iIzhGNUIyNyIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPHJlY3QgeD0iMjAiIHk9IjMwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjI1IiB5PSIzNSIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzMzMzMzMyIHRleHQtYW5jaG9yPSJtaWRkbGUiPjM8L3RleHQ+Cjwvc3ZnPg==" alt="Tower - Pang-uri" style="top: 225px; left: 485px;" onclick="showQuestion(2)">
                    <img class="stage-node locked" id="node-3" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTUiIHk9IjMwIiB3aWR0aD0iMjAiIGhlaWdodD0iMTUiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xNSAzMEwxNSAxNUwyMCAxMEwyMCAxNUwxNSAxNVoiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiNGRkYiLz4KPHRleHQgeD0iMjUiIHk9IjQ1IiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj40PC90ZXh0Pgo8L3N2Zz4=" alt="Cabin - Pang-abay" style="top: 175px; left: 635px;" onclick="showQuestion(3)">
                    <img class="stage-node locked" id="node-4" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTUiIHk9IjI1IiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbGw9IiM4RjU5MjciIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xNSAyNUwxNSAxMEwyMCA1TDIwIDEwTDE1IDEwWiIgZmlsbD0iIzhGNUIyNyIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPHJlY3QgeD0iMjAiIHk9IjMwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjI1IiB5PSIzNSIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzMzMzMzMyIHRleHQtYW5jaG9yPSJtaWRkbGUiPjU8L3RleHQ+Cjwvc3ZnPg==" alt="Watchtower - Panghalip" style="top: 125px; left: 585px;" onclick="showQuestion(4)">
                    <img class="stage-node locked" id="node-5" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTUiIHk9IjMwIiB3aWR0aD0iMjAiIGhlaWdodD0iMTUiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xNSAzMEwxNSAxNUwyMCAxMEwyMCAxNUwxNSAxNVoiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiNGRkYiLz4KPHRleHQgeD0iMjUiIHk9IjQ1IiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj42PC90ZXh0Pgo8L3N2Zz4=" alt="Bridge House - Pang-ukol" style="top: 75px; left: 485px;" onclick="showQuestion(5)">
                    <img class="stage-node locked" id="node-6" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTUiIHk9IjI1IiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbGw9IiM4RjU5MjciIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xNSAyNUwxNSAxMEwyMCA1TDIwIDEwTDE1IDEwWiIgZmlsbD0iIzhGNUIyNyIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPHJlY3QgeD0iMjAiIHk9IjMwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjI1IiB5PSIzNSIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzMzMzMzMyIHRleHQtYW5jaG9yPSJtaWRkbGUiPjY8L3RleHQ+Cjwvc3ZnPg==" alt="Castle Tower - Pangatnig" style="top: 35px; left: 325px;" onclick="showQuestion(6)">

                    <!-- Player as <img> element -->
                    <div class="player" id="player" style="top: 365px; left: 75px;">
                        <img id="player-avatar" src="" alt="Player" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
        </div>

        <div id="question-section" class="question-section">
            <div class="question-container">
                <div class="question" id="question">Loading question...</div>
                <div class="answer-options" id="answer-options">
                    <!-- Answer buttons will be generated here -->
                </div>
                <div id="feedback" class="feedback"></div>
            </div>
        </div>

        <div id="game-over" class="game-over">
            <h2>üéâ Adventure Complete!</h2>
            <p class="final-score">Final Score: <span id="final-score">0</span></p>
            <button class="play-again-btn" onclick="location.reload()">Play Again</button>
            <button class="back-btn" onclick="window.location.href='select.html'">Choose Another Game</button>
        </div>
    </div>

    <script>
        // Game state
        let currentQuestionIndex = 0;
        let score = 0;
        let mapPosition = 0;
        let questions = [];

        // Node positions for player movement
        const nodePositions = [
            { top: 365, left: 75 },
            { top: 295, left: 275 },
            { top: 215, left: 475 },
            { top: 165, left: 625 },
            { top: 115, left: 575 },
            { top: 75, left: 475 },
            { top: 35, left: 325 },
            { top: 15, left: 175 }
        ];

        // Load questions from localStorage (set by teacher) or use defaults
        function loadQuestions() {
            const saved = localStorage.getItem('questQuestions');
            if (saved) {
                questions = JSON.parse(saved);
            } else {
                // Default questions if none saved
                questions = [
                    {
                        question: "Ano ang pangngalan?",
                        options: ["Pang-uri", "Pangngalan", "Pandiwa", "Pang-abay"],
                        correct: 1
                    },
                    {
                        question: "Ano ang pandiwa?",
                        options: ["Salita na naglalarawan", "Salita na nagpapahayag ng aksyon", "Salita na nagpapahayag ng dami", "Salita na nagpapahayag ng lugar"],
                        correct: 1
                    },
                    {
                        question: "Ano ang wastong bantas sa dulo ng tanong?",
                        options: [".", ",", "!", "?"],
                        correct: 3
                    },
                    {
                        question: "Ano ang tamang gamit ng 'nang'?",
                        options: ["Sa harap ng salita", "Sa harap ng pandiwa", "Sa harap ng pangngalan", "Sa harap ng pang-uri"],
                        correct: 1
                    },
                    {
                        question: "Ano ang pangungusap?",
                        options: ["Isang salita", "Grupo ng salita na may buong diwa", "Isang letra", "Isang numero"],
                        correct: 1
                    }
                ];
            }
        }

        // Initialize game
        function initGame() {
            loadQuestions();
            updateProgress();
        }

        // Show question for specific node
        function showQuestion(nodeIndex) {
            if (nodeIndex > mapPosition) return; // Can't access locked nodes

            currentQuestionIndex = nodeIndex;
            const question = questions[currentQuestionIndex];

            document.getElementById('question').textContent = question.question;

            const optionsContainer = document.getElementById('answer-options');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'answer-btn';
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });

            document.getElementById('question-section').style.display = 'block';
            document.getElementById('feedback').style.display = 'none';
        }

        // Handle answer selection
        function selectAnswer(selectedIndex) {
            const question = questions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');

            if (selectedIndex === question.correct) {
                score += 10;
                feedback.textContent = 'Tama! ‚úÖ';
                feedback.className = 'feedback correct';

                // Move player to next node
                if (mapPosition < nodePositions.length - 1) {
                    mapPosition++;
                    movePlayer(mapPosition);
                    updateNodeStates();
                }

                updateProgress();

                // Check if game complete
                if (mapPosition >= questions.length - 1) {
                    setTimeout(() => {
                        endGame();
                    }, 2000);
                } else {
                    setTimeout(() => {
                        document.getElementById('question-section').style.display = 'none';
                    }, 2000);
                }
            } else {
                feedback.textContent = 'Mali ‚ùå';
                feedback.className = 'feedback incorrect';
            }

            document.getElementById('score').textContent = score;
            feedback.style.display = 'block';
        }

        // Move player smoothly to new position
        function movePlayer(position) {
            const player = document.getElementById('player');
            const newPos = nodePositions[position];

            player.classList.add('moving');
            player.style.top = newPos.top + 'px';
            player.style.left = newPos.left + 'px';

            setTimeout(() => {
                player.classList.remove('moving');
            }, 800);
        }

        // Update node states based on progress
        function updateNodeStates() {
            for (let i = 0; i < questions.length; i++) {
                const node = document.getElementById(`node-${i}`);
                node.className = 'stage-node'; // Reset classes

                if (i < mapPosition) {
                    node.classList.add('completed');
                } else if (i === mapPosition) {
                    node.classList.add('current');
                } else if (i === mapPosition + 1) {
                    node.classList.add('unlocked');
                } else {
                    node.classList.add('locked');
                }
            }
        }

        // Update progress display
        function updateProgress() {
            document.getElementById('progress').textContent = `${mapPosition + 1}/${questions.length}`;
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = `${((mapPosition + 1) / questions.length) * 100}%`;
        }

        // End game
        function endGame() {
            document.getElementById('question-section').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('final-score').textContent = score;

            // Save score to localStorage
            const gameData = {
                score,
                progress: mapPosition,
                date: new Date().toISOString(),
                studentName: sessionStorage.getItem('studentName') || 'Student'
            };
            localStorage.setItem('knowledgeQuestScore', JSON.stringify(gameData));
        }

        // Show checkpoint tooltip
        function showCheckpointTooltip(nodeIndex) {
            const tooltip = document.getElementById('tooltip');
            const node = document.getElementById(`node-${nodeIndex}`);
            const rect = node.getBoundingClientRect();
            const mapRect = document.getElementById('worldMap').getBoundingClientRect();

            let status = 'Locked';
            let statusColor = '#f44336';

            if (nodeIndex < mapPosition) {
                status = 'Completed';
                statusColor = '#4CAF50';
            } else if (nodeIndex === mapPosition) {
                status = 'Current Stage';
                statusColor = '#FF9800';
            } else if (nodeIndex === mapPosition + 1) {
                status = 'Unlocked';
                statusColor = '#2196F3';
            }

            tooltip.innerHTML = `Stage ${nodeIndex + 1}: ${status}`;
            tooltip.style.left = (rect.left - mapRect.left + rect.width / 2 - 50) + 'px';
            tooltip.style.top = (rect.top - mapRect.top - 40) + 'px';
            tooltip.style.color = statusColor;
            tooltip.classList.add('show');
        }

        // Hide checkpoint tooltip
        function hideCheckpointTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('show');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
