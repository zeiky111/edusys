<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Database Setup - Wikahusayan</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: rgba(67, 233, 123, 0.2); color: #43e97b; }
        .error { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .warning { background: rgba(79, 172, 254, 0.2); color: #4facfe; }
        .info { background: rgba(149, 165, 166, 0.2); color: #95a5a6; }

        button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .form-group {
            margin: 15px 0;
        }

        .collection-section {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .collection-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
        }

        .data-preview {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .sample-data-btn {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
    </style>
</head>
<body>
    <h1>üîß Manual Database Setup - Wikahusayan Leaderboard</h1>

    <div class="container">
        <h2>Firebase Authentication</h2>
        <div id="auth-status" class="status warning">Checking authentication...</div>
        <button onclick="testAuth()">Test Authentication</button>
        <button onclick="signInAnonymously()">Sign In Anonymously</button>
    </div>

    <div class="container">
        <h2>Add Leaderboard Data</h2>
        <div id="db-section" style="display: none;">

            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('ladder')">Ladder Quiz</button>
                <button class="tab-btn" onclick="showTab('speed')">Speed Challenge</button>
                <button class="tab-btn" onclick="showTab('matching')">Matching Game</button>
                <button class="tab-btn" onclick="showTab('overall')">Overall</button>
            </div>

            <!-- Ladder Quiz Tab -->
            <div id="ladder-tab" class="tab-content active">
                <div class="collection-section">
                    <div class="collection-title">üéØ Ladder Quiz Scores (leaderboard_ladder)</div>

                    <div class="form-group">
                        <label>Display Name:</label>
                        <input type="text" id="ladder-name" placeholder="Student Name">
                    </div>

                    <div class="form-group">
                        <label>Score/Points:</label>
                        <input type="number" id="ladder-score" placeholder="100" min="0">
                    </div>

                    <div class="form-group">
                        <label>User ID (optional - leave empty for auto):</label>
                        <input type="text" id="ladder-userid" placeholder="Auto-generated">
                    </div>

                    <button onclick="addLadderScore()">Add Ladder Score</button>
                    <button class="sample-data-btn" onclick="addSampleLadderData()">Add Sample Data</button>
                    <button onclick="clearCollection('leaderboard_ladder')" style="background: #ff6b6b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-left: 10px;">üóëÔ∏è Clear</button>
                </div>
            </div>

            <!-- Speed Challenge Tab -->
            <div id="speed-tab" class="tab-content">
                <div class="collection-section">
                    <div class="collection-title">‚ö° Speed Challenge Scores (leaderboard_speed_challenge)</div>

                    <div class="form-group">
                        <label>Display Name:</label>
                        <input type="text" id="speed-name" placeholder="Student Name">
                    </div>

                    <div class="form-group">
                        <label>Score/Points:</label>
                        <input type="number" id="speed-score" placeholder="500" min="0">
                    </div>

                    <div class="form-group">
                        <label>User ID (optional):</label>
                        <input type="text" id="speed-userid" placeholder="Auto-generated">
                    </div>

                    <button onclick="addSpeedScore()">Add Speed Score</button>
                    <button class="sample-data-btn" onclick="addSampleSpeedData()">Add Sample Data</button>
                    <button onclick="clearCollection('leaderboard_speed_challenge')" style="background: #ff6b6b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-left: 10px;">üóëÔ∏è Clear</button>
                </div>
            </div>

            <!-- Matching Game Tab -->
            <div id="matching-tab" class="tab-content">
                <div class="collection-section">
                    <div class="collection-title">üîó Matching Game Scores (leaderboard_drag_drop)</div>

                    <div class="form-group">
                        <label>Display Name:</label>
                        <input type="text" id="matching-name" placeholder="Student Name">
                    </div>

                    <div class="form-group">
                        <label>Group Name:</label>
                        <input type="text" id="matching-group" placeholder="Group A">
                    </div>

                    <div class="form-group">
                        <label>Accumulated Points:</label>
                        <input type="number" id="matching-score" placeholder="250" min="0">
                    </div>

                    <div class="form-group">
                        <label>User ID (optional):</label>
                        <input type="text" id="matching-userid" placeholder="Auto-generated">
                    </div>

                    <button onclick="addMatchingScore()">Add Matching Score</button>
                    <button class="sample-data-btn" onclick="addSampleMatchingData()">Add Sample Data</button>
                    <button onclick="clearCollection('leaderboard_drag_drop')" style="background: #ff6b6b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-left: 10px;">üóëÔ∏è Clear</button>
                </div>
            </div>

            <!-- Overall Tab -->
            <div id="overall-tab" class="tab-content">
                <div class="collection-section">
                    <div class="collection-title">üìä Overall Leaderboard (leaderboard)</div>

                    <div class="form-group">
                        <label>Display Name:</label>
                        <input type="text" id="overall-name" placeholder="Student Name">
                    </div>

                    <div class="form-group">
                        <label>Total Points:</label>
                        <input type="number" id="overall-score" placeholder="750" min="0">
                    </div>

                    <div class="form-group">
                        <label>User ID (optional):</label>
                        <input type="text" id="overall-userid" placeholder="Auto-generated">
                    </div>

                    <button onclick="addOverallScore()">Add Overall Score</button>
                    <button class="sample-data-btn" onclick="addSampleOverallData()">Add Sample Data</button>
                    <button onclick="clearCollection('leaderboard')" style="background: #ff6b6b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-left: 10px;">üóëÔ∏è Clear</button>
                </div>
            </div>

            <div id="result" class="status info" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h2>View Existing Data</h2>
        <button onclick="viewAllCollections()">View All Collections</button>
        <button onclick="clearAllSampleData()" style="background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%); margin-left: 10px;">üóëÔ∏è Clear ALL Sample Data</button>
        <div id="collections-data" class="data-preview" style="display: none;"></div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInAnonymously as firebaseSignInAnonymously } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, query, orderBy, limit, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD9khDPPquuztCUWLfzithwPmQFpI8t49g",
            authDomain: "wikahusayan-quest.firebaseapp.com",
            projectId: "wikahusayan-quest",
            storageBucket: "wikahusayan-quest.firebasestorage.app",
            messagingSenderId: "744849133114",
            appId: "1:744849133114:web:31c5f34bc1ace7e3a5ef03"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        // Monitor auth state
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            const statusDiv = document.getElementById('auth-status');
            const dbSection = document.getElementById('db-section');

            if (user) {
                statusDiv.textContent = `‚úÖ Authenticated as: ${user.uid}`;
                statusDiv.className = 'status success';
                dbSection.style.display = 'block';
            } else {
                statusDiv.textContent = '‚ùå Not authenticated - Sign in to add data';
                statusDiv.className = 'status error';
                dbSection.style.display = 'none';
            }
        });

        // Test authentication
        window.testAuth = async function() {
            if (currentUser) {
                alert('Already authenticated!');
                return;
            }
            try {
                await firebaseSignInAnonymously(auth);
                alert('Authentication successful!');
            } catch (error) {
                alert('Authentication failed: ' + error.message);
            }
        };

        // Sign in anonymously
        window.signInAnonymously = async function() {
            await window.testAuth();
        };

        // Tab switching
        window.showTab = function(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        };

        // Add Ladder Score
        window.addLadderScore = async function() {
            const name = document.getElementById('ladder-name').value.trim();
            const score = parseInt(document.getElementById('ladder-score').value);
            const userId = document.getElementById('ladder-userid').value.trim() || generateUserId();

            if (!name || isNaN(score)) {
                alert('Please fill in name and score');
                return;
            }

            try {
                const data = {
                    userId: userId,
                    displayName: name,
                    points: score,
                    updatedAt: new Date(),
                    createdAt: new Date()
                };

                await addDoc(collection(db, 'leaderboard_ladder'), data);
                showResult(`‚úÖ Added ladder score for ${name}: ${score} points`);
                clearForm('ladder');
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'error');
            }
        };

        // Add Speed Score
        window.addSpeedScore = async function() {
            const name = document.getElementById('speed-name').value.trim();
            const score = parseInt(document.getElementById('speed-score').value);
            const userId = document.getElementById('speed-userid').value.trim() || generateUserId();

            if (!name || isNaN(score)) {
                alert('Please fill in name and score');
                return;
            }

            try {
                const data = {
                    userId: userId,
                    displayName: name,
                    points: score,
                    updatedAt: new Date(),
                    createdAt: new Date()
                };

                await addDoc(collection(db, 'leaderboard_speed_challenge'), data);
                showResult(`‚úÖ Added speed score for ${name}: ${score} points`);
                clearForm('speed');
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'error');
            }
        };

        // Add Matching Score
        window.addMatchingScore = async function() {
            const name = document.getElementById('matching-name').value.trim();
            const group = document.getElementById('matching-group').value.trim();
            const score = parseInt(document.getElementById('matching-score').value);
            const userId = document.getElementById('matching-userid').value.trim() || generateUserId();

            if (!name || !group || isNaN(score)) {
                alert('Please fill in name, group, and score');
                return;
            }

            try {
                const data = {
                    userId: userId,
                    displayName: name,
                    groupName: group,
                    points: score,
                    updatedAt: new Date(),
                    createdAt: new Date()
                };

                await addDoc(collection(db, 'leaderboard_drag_drop'), data);
                showResult(`‚úÖ Added matching score for ${name} (${group}): ${score} points`);
                clearForm('matching');
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'error');
            }
        };

        // Add Overall Score
        window.addOverallScore = async function() {
            const name = document.getElementById('overall-name').value.trim();
            const score = parseInt(document.getElementById('overall-score').value);
            const userId = document.getElementById('overall-userid').value.trim() || generateUserId();

            if (!name || isNaN(score)) {
                alert('Please fill in name and score');
                return;
            }

            try {
                const data = {
                    userId: userId,
                    displayName: name,
                    totalPoints: score,
                    updatedAt: new Date(),
                    createdAt: new Date()
                };

                await addDoc(collection(db, 'leaderboard'), data);
                showResult(`‚úÖ Added overall score for ${name}: ${score} points`);
                clearForm('overall');
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'error');
            }
        };

        // Sample data functions
        window.addSampleLadderData = async function() {
            const sampleData = [
                { name: 'Maria Santos', score: 150 },
                { name: 'Juan dela Cruz', score: 120 },
                { name: 'Ana Reyes', score: 100 },
                { name: 'Pedro Garcia', score: 80 }
            ];

            for (const item of sampleData) {
                try {
                    const data = {
                        userId: generateUserId(),
                        displayName: item.name,
                        points: item.score,
                        updatedAt: new Date(),
                        createdAt: new Date()
                    };
                    await addDoc(collection(db, 'leaderboard_ladder'), data);
                } catch (error) {
                    console.error('Error adding sample data:', error);
                }
            }
            showResult('‚úÖ Added sample ladder quiz data');
        };

        window.addSampleSpeedData = async function() {
            const sampleData = [
                { name: 'Maria Santos', score: 450 },
                { name: 'Juan dela Cruz', score: 380 },
                { name: 'Ana Reyes', score: 320 },
                { name: 'Pedro Garcia', score: 290 }
            ];

            for (const item of sampleData) {
                try {
                    const data = {
                        userId: generateUserId(),
                        displayName: item.name,
                        points: item.score,
                        updatedAt: new Date(),
                        createdAt: new Date()
                    };
                    await addDoc(collection(db, 'leaderboard_speed_challenge'), data);
                } catch (error) {
                    console.error('Error adding sample data:', error);
                }
            }
            showResult('‚úÖ Added sample speed challenge data');
        };

        window.addSampleMatchingData = async function() {
            const sampleData = [
                { name: 'Maria Santos', group: 'Group A', score: 200 },
                { name: 'Juan dela Cruz', group: 'Group A', score: 180 },
                { name: 'Ana Reyes', group: 'Group B', score: 160 },
                { name: 'Pedro Garcia', group: 'Group B', score: 140 }
            ];

            for (const item of sampleData) {
                try {
                    const data = {
                        userId: generateUserId(),
                        displayName: item.name,
                        groupName: item.group,
                        points: item.score,
                        updatedAt: new Date(),
                        createdAt: new Date()
                    };
                    await addDoc(collection(db, 'leaderboard_drag_drop'), data);
                } catch (error) {
                    console.error('Error adding sample data:', error);
                }
            }
            showResult('‚úÖ Added sample matching game data');
        };

        window.addSampleOverallData = async function() {
            const sampleData = [
                { name: 'Maria Santos', score: 800 },
                { name: 'Juan dela Cruz', score: 680 },
                { name: 'Ana Reyes', score: 580 },
                { name: 'Pedro Garcia', score: 510 }
            ];

            for (const item of sampleData) {
                try {
                    const data = {
                        userId: generateUserId(),
                        displayName: item.name,
                        totalPoints: item.score,
                        updatedAt: new Date(),
                        createdAt: new Date()
                    };
                    await addDoc(collection(db, 'leaderboard'), data);
                } catch (error) {
                    console.error('Error adding sample data:', error);
                }
            }
            showResult('‚úÖ Added sample overall leaderboard data');
        };

        // View all collections
        window.viewAllCollections = async function() {
            if (!currentUser) {
                alert('You must be authenticated to view collections!');
                return;
            }

            const collections = ['leaderboard_ladder', 'leaderboard_speed_challenge', 'leaderboard_drag_drop', 'leaderboard'];
            const dataDiv = document.getElementById('collections-data');
            let output = `üîç Checking collections as user: ${currentUser.uid}\n\n`;

            for (const collName of collections) {
                try {
                    console.log(`Attempting to read from collection: ${collName}`);
                    const q = query(collection(db, collName), orderBy('points', 'desc'), limit(5));
                    const querySnapshot = await getDocs(q);

                    output += `üìÇ ${collName.toUpperCase()} (${querySnapshot.size} documents):\n`;
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        output += `  - ${data.displayName}: ${data.points || data.totalPoints} pts`;
                        if (data.groupName) output += ` (${data.groupName})`;
                        output += '\n';
                    });
                    output += '\n';
                } catch (error) {
                    console.error(`Error loading ${collName}:`, error);
                    output += `‚ùå Error loading ${collName}: ${error.message}\n\n`;
                }
            }

            dataDiv.textContent = output;
            dataDiv.style.display = 'block';
        };

        // Clear all sample data
        window.clearAllSampleData = async function() {
            if (!currentUser) {
                alert('You must be authenticated to clear data!');
                return;
            }

            if (!confirm('‚ö†Ô∏è WARNING: This will delete ALL data from ALL leaderboard collections!\n\nAre you sure you want to continue?')) {
                return;
            }

            const collections = ['leaderboard_ladder', 'leaderboard_speed_challenge', 'leaderboard_drag_drop', 'leaderboard'];
            let totalDeleted = 0;

            try {
                showResult('üóëÔ∏è Clearing all sample data...', 'warning');

                for (const collName of collections) {
                    console.log(`Clearing collection: ${collName}`);
                    const querySnapshot = await getDocs(collection(db, collName));

                    const deletePromises = [];
                    querySnapshot.forEach((doc) => {
                        deletePromises.push(deleteDoc(doc.ref));
                        totalDeleted++;
                    });

                    await Promise.all(deletePromises);
                    console.log(`‚úÖ Cleared ${querySnapshot.size} documents from ${collName}`);
                }

                showResult(`‚úÖ Successfully deleted ${totalDeleted} documents from all collections!`, 'success');
                console.log(`üóëÔ∏è Total documents deleted: ${totalDeleted}`);

                // Refresh the view
                setTimeout(() => {
                    viewAllCollections();
                }, 1000);

            } catch (error) {
                console.error('Error clearing data:', error);
                showResult(`‚ùå Error clearing data: ${error.message}`, 'error');
            }
        };

        // Clear specific collection
        window.clearCollection = async function(collectionName) {
            if (!currentUser) {
                alert('You must be authenticated to clear data!');
                return;
            }

            const collectionDisplayName = collectionName.replace('leaderboard_', '').replace('leaderboard', 'overall');
            if (!confirm(`üóëÔ∏è Delete ALL data from ${collectionDisplayName} collection?\n\nThis action cannot be undone!`)) {
                return;
            }

            try {
                showResult(`üóëÔ∏è Clearing ${collectionDisplayName} collection...`, 'warning');

                const querySnapshot = await getDocs(collection(db, collectionName));
                const deletePromises = [];

                querySnapshot.forEach((doc) => {
                    deletePromises.push(deleteDoc(doc.ref));
                });

                await Promise.all(deletePromises);

                showResult(`‚úÖ Deleted ${querySnapshot.size} documents from ${collectionDisplayName}!`, 'success');
                console.log(`üóëÔ∏è Cleared ${querySnapshot.size} documents from ${collectionName}`);

                // Refresh the view
                setTimeout(() => {
                    viewAllCollections();
                }, 500);

            } catch (error) {
                console.error('Error clearing collection:', error);
                showResult(`‚ùå Error clearing ${collectionDisplayName}: ${error.message}`, 'error');
            }
        };

        // Helper functions
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        function clearForm(prefix) {
            document.getElementById(prefix + '-name').value = '';
            document.getElementById(prefix + '-score').value = '';
            document.getElementById(prefix + '-userid').value = '';
            if (prefix === 'matching') {
                document.getElementById(prefix + '-group').value = '';
            }
        }

        function showResult(message, type = 'success') {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `status ${type}`;
            resultDiv.style.display = 'block';

            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>