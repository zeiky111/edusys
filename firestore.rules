rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow users to read/write their own user data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Allow authenticated users to read/write their own game content
    match /game_content/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Allow authenticated users to read/write game questions
    match /game_questions/{document} {
      allow read, write: if request.auth != null;
    }

    // Allow anyone to read topics and allow authenticated writes
    match /topics/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Allow anyone to read lesson_content and allow authenticated writes
    match /lesson_content/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Allow authenticated users to read/write their own progress
    match /game_progress/{document} {
      allow read, write: if request.auth != null && document.matches(request.auth.uid + '.*');
    }

    // Allow authenticated users to read/write their own points
    match /user_points/{document} {
      allow read, write: if request.auth != null && document == request.auth.uid;
    }

    // Allow authenticated users to read/write their own badges
    match /user_badges/{document} {
      allow read, write: if request.auth != null && document == request.auth.uid;
    }

    // Allow anyone to read/write leaderboard data (for anonymous play)
    match /leaderboard/{document} {
      allow read: if true;
      allow write: if true;
    }

    // Allow anyone to read/write leaderboard_ladder data
    match /leaderboard_ladder/{document} {
      allow read: if true;
      allow write: if true;
    }

    // Allow anyone to read/write leaderboard_speed_challenge data
    match /leaderboard_speed_challenge/{document} {
      allow read: if true;
      allow write: if true;
    }

    // Allow anyone to read/write leaderboard_drag_drop data
    match /leaderboard_drag_drop/{document} {
      allow read: if true;
      allow write: if true;
    }

    // Allow anyone to read/write leaderboard_quest data
    match /leaderboard_quest/{document} {
      allow read: if true;
      allow write: if true;
    }
  }
}